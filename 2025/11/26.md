## 取り組んだ課題一覧
- DjangoでECサイトを作る（カート機能実装・テンプレ整理）
- JavaScript入門・完全版コース
- JavaScript Primer（〜クラス）

## わかったこと
- サービス層は「HTTPとは関係ないアプリのビジネスロジック」をまとめておく層で、views.py から処理を切り出すことでビューがスッキリしテストしやすくなり仕様変更にも強くなる。
- `get_or_create_cart(request)` のような関数は「セッションIDの有無をチェック → なければ `request.session.save()` で発行 → `session_key` を使って `Cart.objects.get_or_create()`」というアプリ固有の処理を一箇所に閉じ込める役割を持つ。
- `@require_POST` デコレータを付けることで、そのビューに対して GET などの不要なアクセスを防ぎフォーム送信専用のエンドポイントとして振る舞わせることができる。
- `add_to_cart` ビューでは、`request.POST.get("quantity", "1")` で数量を受け取り、変換に失敗した場合や 0 以下の場合は安全側に倒して 1 にすることで異常値からカートを守るようにしている。
- すでに同じ商品がカートにある場合、`CartItem.objects.get_or_create()` で取得したレコードに対して数量だけを加算し、重複行を増やさない実装にすることでカート表示がシンプルになり集計もしやすくなる。
- `cart_detail` ビューでは、「セッションキーがない → Cart がない → Cart はあるが items がない」という3パターンを丁寧にハンドリングしたうえで、`select_related("product")` で N+1 を避けつつ `sum(item.product.price * item.quantity for item in items)` で合計金額を算出している。
- `cart_item_delete` では、`session_key` から Cart を取得し、その Cart に紐づく `CartItem` だけを削除対象にすることで他人のカートアイテムを URL 直叩きで消せないようにしている点が重要な安全策になっている。
- Django テンプレートの `TemplateSyntaxError: Invalid filter: 'intcomma'` は、Django テンプレートエンジンが「そのフィルタ名を知らない」ときに出るエラーで、今回は `django.contrib.humanize` を `INSTALLED_APPS` に入れていなかった＆テンプレートで `{% load humanize %}` していなかったことが原因だった。
- `intcomma` フィルタは整数値を 3 桁ごとにカンマ区切りにしてくれるフィルタで、`¥{{ price|intcomma }}` のように使うことで価格表示がお金っぽく読みやすくなる。
- 商品詳細ページの数量指定は、`product.stock` から `max_quantity` を導き、`list(range(1, max_quantity + 1))` を作って `quantity_range` としてテンプレに渡すことで、在庫数に応じたプルダウンの選択肢を柔軟に生成できる。
- 商品一覧／詳細テンプレートの「カートに入れる」は、`<a>` ではなく `<form method="post" action="...">` に変えることで、CSRF 対策付きの POST リクエストとして実装できREST 的にも「状態変更は POST」という形に近づけることができた。

## 感じたこと、メモ
- view がごちゃついてきたら「services に逃がす」という逃げ道を持てたのが心強い。
- `intcomma` ひとつ動かすのにも `INSTALLED_APPS` の追加と `{% load %}` の両方が必要で、Django の「アプリを追加してテンプレタグを読み込む」という流れがわかった
- JS Primer読み始めてみたがかなり細かく書かれていて勉強になる

## 次やること
- DjangoでECサイトを作る（カート画面の小計・合計表示や価格フォーマットの微調整）

## 学習時間
- 今日：5h45m
- 今週：25h30m（土-）
- 今月：93h30m
- 累計：769h45m